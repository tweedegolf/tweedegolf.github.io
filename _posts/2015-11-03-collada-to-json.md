---
layout: post
thumb:
leadimg:
tags: Collada, Three.js, 3D, optimization, webgl
author: Daniel
description: Optimizing 3D models by converting Collada's to JSON
nerd: 3
---

So far we have been using 3D models in Collada format in our 3D projects. Our 3D artist [Boris Ignjatovic](http://www.borisignjatovic.com/) works in Maya 3D and after quite some experimenting we found that Collada was the export format that worked best for us.

However, the Collada format is an interchange format, not a delivery format. Where a delivery format should be as small as possible and optimized for parsing by the receiving end, an interchange format doesn't have such requirements. Because Collada is XML it is rather verbose. And to parse a Collada, Threejs has to loop over every node of the tree and convert it to a Threejs 3D object.


#### Threejs' JSON format

Therefor we decided to try Threejs' own JSON format. JSON is less verbose and because it is Threejs' own format, parsing is done in a breeze. After some fruitless experiments with Maya's Threejs JSON exporter and some existing Collada to JSON converters, we tried our luck with Threejs' built in `toJSON()` method.

Every 3D object inherits the `toJSON()` method from the class Object3D, so you can convert a loaded Collada model to JSON and then save it to disk. We wanted to wrap this idea into a Nodejs app but the [ColladaLoader](https://github.com/mrdoob/three.js/blob/master/examples/js/loaders/ColladaLoader.js) for Threejs depends on the [DOMParser](https://developer.mozilla.org/en-US/docs/Web/API/DOMParser), and there is not yet an adequate equivalent for this in Nodejs.

So we made an online converter. There are 2 versions; a version that shows the model as Collada and as JSON, and a 'headless' version that just converts the Collada. The first version is suitable if you want to convert only a few models and check the models side by side for possible conversion errors [[link](http://data.tweedegolf.nl/collada2json/)]. If you want to convert a large number of Colladas you'd better use the second version [[link](http://data.tweedegolf.nl/collada2json_headless/)].


#### How it works

First the Collada gets parsed by the DOMParser to search for textures. This is necessary because Threejs' `toJSON()` method does not include textures in the resulting JSON object.

We add the images of all found textures to the `THREE.Cache` object. By doing so we suppress error messages generated by the Collada loader.

Then we use the `parse()` method of the ColladaLoader to parse the Collada model into a Threejs `Group`, and because a `Group` inherits from `Object3D` we can convert it to JSON right away.

The last step is to add the texture images to the JSON file save the result as a Blob using `URL.createObjectURL`.



#### Code and links
 - [converter with preview](http://data.tweedegolf.nl/collada2json/)
 - [headless converter](http://data.tweedegolf.nl/collada2json_headless/)
 - [code on github](https://github.com/abudaan/collada2json) (the headless version has its own branch "[headless](https://github.com/abudaan/collada2json/tree/headless)")
